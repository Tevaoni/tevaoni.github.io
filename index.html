<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Arrosage – Amiens</title>
  <style>
    body { text-align: center; }
    h1 { color: #22aa77; }
    table {
      width: 100%;
      max-width: 1100px;
      margin: 0 auto;
    }
    th, td { border: 1px solid #22aa77; }
    th { background: #66cc99; }
    .weekend { background-color: #804A80; }
  </style>
</head>
<body>
  <h1>💧 Programme d’arrosage</h1>
  <table>
    <thead>
      <tr>
        <th>📅<br>Date</th>
        <th>🌡️<br>Min/Max</th>
        <th>🔆<br>ETP</th>
        <th>🌧️<br>Pluie</th>
        <th>💧<br>Besoin</th>
        <th>🧮<br>Arrosage</th>
      </tr>
    </thead>
    <tbody id="contenu-tableau"></tbody>
  </table>
  <script>

    //  Tout: { surface: 46900, volume: 54, duree: 136 }
    
        const besoinNet = Math.max(0, etpJour - pluieJour);


        const bonus = calculerBonusPerso(besoinNet);
        const aucunBesoin = bonus === 0;
const coeff = besoinNet / 1.2;


 
    function calculerBonusPerso(besoinNet) {
      if (coeff > 0 && coeff < 1) {
        return coeff > 0.4 ? 100 : 0;
      }
      return Math.floor(coeff) * 100;
    }
    
    async function chargerMeteo() {
        const url = "https://api.open-meteo.com/v1/forecast?latitude=49.8942&longitude=2.2633&daily=temperature_2m_max,temperature_2m_min,et0_fao_evapotranspiration,precipitation_sum&timezone=Europe%2FParis&altitude=22&forecast_days=16";
        const res = await fetch(url);
        const data = await res.json();
        meteo = data.daily;
        afficherProgramme();
    }
    
    function afficherProgramme() {
      const jours = meteo.time, tMax = meteo.temperature_2m_max, tMin = meteo.temperature_2m_min, etp = meteo.et0_fao_evapotranspiration, pluie = meteo.precipitation_sum;
      const tbody = document.getElementById("contenu-tableau");
      tbody.innerHTML = "";
    
      for (let i = 0; i < jours.length; i++) {
        const dateObj = new Date(jours[i]);
        const isWeekend = [0,6].includes(dateObj.getDay());
        const date = dateObj.toLocaleDateString("fr-FR", { weekday: 'short', day: 'numeric', month: 'short' });
        const tmin = tMin[i], tmax = tMax[i], etpJour = etp[i], pluieJour = pluie[i];

        const ligne = `
          <tr>
            <td class="${isWeekend ? 'weekend' : ''}">${date}</td>
            <td>
              <span style="${tmin < 5 ? 'color:blue;font-weight:bold;' : tmin > 30 ? 'color:red;font-weight:bold;' : ''}">${tmin.toFixed(1)}°C</span>
              <br>
              <span style="${tmax < 5 ? 'color:blue;font-weight:bold;' : tmax > 30 ? 'color:red;font-weight:bold;' : ''}">${tmax.toFixed(1)}°C</span>
            </td>
            <td style="${etpJour > 6 ? 'color:red;font-weight:bold;' : ''}">${etpJour.toFixed(1)}mm</td>
            <td style="${pluieJour > 1 ? 'color:blue;font-weight:bold;' : ''}">${pluieJour.toFixed(1)}mm</td>
            <td>
              ${aucunBesoin ? '🚫' : `${bonus}%` }
            </td>
            <td>
              ${besoinNet.toFixed(1)}mm
            </td>
            
          </tr>
        `;
        tbody.insertAdjacentHTML("beforeend", ligne);
      }
    }

    // chargerMeteo();
    // setInterval(chargerMeteo, 30 * 60 * 1000);
  </script>
</body>
</html>
