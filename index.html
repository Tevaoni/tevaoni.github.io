<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Arrosage automatique – Amiens</title>
  <style>
    body { font-family: sans-serif; padding: 2em; max-width: 900px; margin: auto; background: #f9f9f9; }
    h1 { color: #2a7; }
    table { width: 100%; border-collapse: collapse; margin-top: 1em; }
    th, td { padding: 0.7em; border: 1px solid #ccc; text-align: center; }
    th { background: #e8f5e9; }
    tr:nth-child(even) { background-color: #f1f1f1; }
  </style>
</head>
<body>
  <h1>💧 Programme d’arrosage automatique – Stade La Licorne, Amiens</h1>
  <p>Données météo en direct via <strong>Open-Meteo</strong> pour un terrain de 7 500 m². Mise à jour quotidienne automatique.</p>

  <table id="tableau">
    <tr>
      <th>📅 Date</th>
      <th>🌡️ T° Max / Min</th>
      <th>🔆 ETP réelle (mm)</th>
      <th>💧 Besoin estimé (m³)</th>
      <th>🔁 Programme</th>
      <th>⏱️ Temps</th>
      <th>⏱️&💧tout</th>
    </tr>
  </table>

  <script>
    const surface = 7500;
    const volumeParCycle = 9;
    const dureeParCycle = 24;

    async function afficherProgramme() {
      const url = "https://api.open-meteo.com/v1/forecast?latitude=49.8942&longitude=2.2633&daily=temperature_2m_max,temperature_2m_min,et0_fao_evapotranspiration&timezone=Europe%2FParis&altitude=22";
      const res = await fetch(url);
      const data = await res.json();
      
    // ✅ Vérifie que les données sont bien structurées avant d’avancer
    if (!data.daily || !data.daily.time) {
      console.error("Erreur dans la réponse API :", data);
      return;
    }

      const jours = data.daily.time;
      const tMax = data.daily.temperature_2m_max;
      const tMin = data.daily.temperature_2m_min;
      const etp = data.daily.et0_fao_evapotranspiration;

      const table = document.getElementById("tableau");

      for (let i = 0; i < 7; i++) {
        const date = new Date(jours[i]).toLocaleDateString("fr-FR", { weekday: 'short', day: 'numeric', month: 'short' });
        const tmax = tMax[i];
        const tmin = tMin[i];
        const etpJour = etp[i];
        const besoin = (etpJour * surface) / 1000;
        const cycles = Math.min(6, Math.ceil(besoin / volumeParCycle));
        const volumeTotal = cycles * volumeParCycle;
        const temps = cycles * dureeParCycle;
        // pour le programme tout
        const volume6Terrains = volumeTotal * 6;
        const temps6Terrains = temps * 5.66;
        const heures6T = Math.floor(temps6Terrains / 60);
        const minutes6T = Math.round(temps6Terrains % 60);


        const ligne = `
          <tr>
            <td>${date}</td>
            <td>${tmax.toFixed(1)}° / ${tmin.toFixed(1)}°</td>
            <td>${etpJour.toFixed(1)}</td>
            <td>${besoin.toFixed(1)}</td>
            <td>×${cycles} (9×${cycles} = ${volumeTotal} m³)</td>
            <td>${Math.floor(temps/60)}h ${temps%60}min</td>
            <td>${volume6Terrains.toFixed(1)}m³ & ${heures6T}h ${minutes6T}min</td>
          </tr>
        `;
        table.insertAdjacentHTML("beforeend", ligne);
      }
    }

    afficherProgramme();
  </script>
</body>
</html>
